(()=>{"use strict";const e=document.querySelector(".player"),t=document.querySelector(".player .random"),n=document.querySelector(".player .repeat"),o=document.querySelector(".player .next"),r=document.querySelector(".player .previous"),s=document.querySelector("body"),c=document.querySelector(".current-playlist"),i=document.querySelector(".player-header"),a=document.querySelector(".bottom-icons"),d=document.querySelectorAll(".view-playlist"),l=document.querySelector(".current-playlist .player-header img"),u=document.querySelector(".now-playing"),m=document.querySelector(".progress-bar"),p=m.querySelector(".passed"),y=(m.querySelector(".total"),m.querySelector(".bar"));window.getComputedStyle(y,"::after");const h=document.querySelector(".current-playlist-wrapper"),v=document.querySelectorAll("nav ul a"),L=(document.querySelector("button.logout"),document.querySelectorAll(".like"));let f=!1;const g=document.querySelector(".like-wrap.mobile.open"),S=document.querySelector(".library-title.add"),q=document.querySelector(".library-title.add span"),E=document.querySelector(".library-title.add input"),w=document.querySelector(".createBtn"),k=(document.querySelector("#playlistForm"),document.querySelector("#searchForm"),document.querySelectorAll(".add-to-library")),b=document.querySelector(".view-library");function C(e){const t=e.target.classList[0];F.splice(t,1),J()}function T(){let e=location.pathname;if(v.forEach((e=>{e.classList.remove("active")})),"/profile"!==e){let t=document.querySelector('[href="'+e+'"]');"/"==e&&(t=document.querySelector("nav ul a:first-of-type")),t&&t.classList.add("active")}}document.querySelector(".edit-library"),document.querySelectorAll("#library .cover-wrapper"),document.querySelectorAll(".deleteBtn"),u.addEventListener("click",(()=>{window.innerWidth<600&&(e.classList.add("open"),g.classList.remove("hidden"),s.classList.add("not-overflowY"),i.classList.remove("hidden"),a.classList.remove("hidden"))})),d.forEach((e=>{e.addEventListener("click",(()=>{a.classList.add("hidden"),s.classList.toggle("not-overflowY"),c.classList.toggle("hidden"),J()}))})),l.addEventListener("click",(()=>{s.classList.remove("not-overflowY"),c.classList.add("hidden"),a.classList.remove("hidden")})),document.querySelector(".player-header img").addEventListener("click",(t=>{t.stopPropagation(),e.classList.remove("open"),g.classList.add("hidden"),s.classList.remove("not-overflowY"),i.classList.add("hidden"),a.classList.add("hidden"),b.classList.add("hidden"),q.classList.remove("hidden"),E.classList.add("hidden"),w.classList.add("hidden"),E.value=""})),window.addEventListener("resize",(()=>{if(window.innerWidth>=600&&e.classList.contains("open")&&(e.classList.remove("open"),i.classList.add("hidden"),a.classList.add("hidden"),g.classList.add("hidden")),window.innerWidth<600){const t=document.querySelector(".bottom-icons.mobile");e.classList.contains("open")||t.classList.add("hidden"),c.classList.contains("hidden")||c.classList.add("hidden")}})),T();const M=document.querySelectorAll(".play");document.querySelector("#iframe");var x=document.createElement("script");x.src="https://www.youtube.com/iframe_api";var A,P=document.getElementsByTagName("script")[0];P.parentNode.insertBefore(x,P);const I=document.querySelector(".player .info .title span"),$=document.querySelector(".player .info .performer span"),B=document.querySelector(".player .info .composer span"),H=document.querySelector(".player .cover-wrapper");let N,_=-1,D="none",V="none";function O(){D=F[_],V=D.videoId,fetch("/checkLiked",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({currentVideoId:V})}).then((e=>e.json())).then((e=>{const{isLiked:t}=e;f=t,le(f)})).catch((e=>{console.error("Error occured: ",e)})),A.loadVideoById(V),document.querySelectorAll(".player .cover-wrapper").forEach((e=>{e.style.backgroundImage=`url(${X})`})),H.style.backgroundImage=`url(${D.thumbnail})`,I.textContent=D.title,$.textContent=D.performer,B.textContent=D.composer,N=!0}h.querySelectorAll("div").forEach((e=>{e.addEventListener("click",(()=>{var t;t=e.className,_=t,O()}))}));let R="none";n.addEventListener("click",(()=>{"none"===R?R=!0:!0===R?R="playlistRepeat":"playlistRepeat"===R&&(R="none"),n.src=!0===R?"/static/icons/repeat_one.svg":"playlistRepeat"===R?"/static/icons/repeat_active.svg":"/static/icons/repeat_inactive.svg"})),setInterval((function(){if(N){let e=Math.floor(A.getCurrentTime()/60),t=Math.trunc(A.getCurrentTime()-60*e);!0===Y?z=Math.floor(A.getCurrentTime())/Math.floor(A.getDuration())*100:void 0!==Y&&!1!==Y||(z=Math.floor(A.getCurrentTime())/60*100,A.getCurrentTime()>=60&&(N=!N,A.stopVideo(),N?M.forEach((e=>{e.className="pause",e.src="/static/icons/pause.svg"})):N||M.forEach((e=>{e.className="play",e.src="/static/icons/play.svg"})))),0==t?t="00":t<10&&(t=`0${t}`),p.textContent=`${e}:${t}`,y.style.setProperty("--after-width",`${z}%`)}}),1e3);let Y=!1,j=!1;t.addEventListener("click",(()=>{j?(j=!1,t.src="/static/icons/random_inactive.svg"):(j=!0,t.src="/static/icons/random_active.svg")}));let W=0;o.addEventListener("click",(function(){if(W=_,j)do{_=Math.floor(Math.random()*(F.length-1))}while(_===W);else _==F.length-1?_=0:_+=1;F!==[]&&O()})),r.addEventListener("click",(function(){j?_=W:0!=_&&(_-=1),F!==[]&&O()}));let F=[];function J(){h.innerHTML="";let e=0;F.forEach((t=>{(function(e,t,n,o){const r=document.createElement("div");r.classList.add("element");const s=document.createElement("div");s.classList.add("cover-wrapper"),s.style.backgroundImage=`url(${n})`,s.setAttribute("onclick",`playInPlaylist(${o})`);const c=document.createElement("div");c.classList.add("info");const i=document.createElement("div");i.classList.add("title"),i.textContent=e;const a=document.createElement("div");a.classList.add("performer"),a.textContent=t;const d=document.createElement("div");d.classList.add("drag");const l=document.createElement("img");l.src="/static/icons/close.svg",l.classList.add("delete-playlist"),l.onclick=C,d.appendChild(l),c.appendChild(i),c.appendChild(a),r.appendChild(s),r.appendChild(c),r.appendChild(d),r.className=o,h.appendChild(r)})(t.title,t.performer,t.thumbnail,e),e++}))}let z=0;y.addEventListener("click",(function(e){const t=(e.clientX-y.getBoundingClientRect().left)/y.clientWidth*100;!0===Y?A.seekTo(A.getDuration()*(.01*t)):A.seekTo(.01*t*60),y.style.setProperty("--after-width",`${t}%`)}));let X="";const G=document.querySelector(".soundbar-container"),K=document.querySelector(".soundbar-wrapper"),Q=document.querySelector(".soundbar"),U="--sound-height";let Z=!1;function ee(e){Z=!0,e.preventDefault(),se(e)}function te(e){Z&&(e.preventDefault(),se(e),ae())}function ne(){Z=!1}K.addEventListener("mousedown",ee),K.addEventListener("touchstart",ee),document.addEventListener("mousemove",te),document.addEventListener("touchmove",te),document.addEventListener("mouseup",ne),document.addEventListener("touchend",ne);const oe=document.querySelector(".sound");let re=0;function se(e){const t=K.offsetHeight,n=K.getBoundingClientRect(),o=e.clientY;let r=n.bottom-o,s=Math.max(0,Math.min(r,t))/t*100;re=`${Math.floor(r)}px`,ce||Math.floor(r)>60&&(re="60px"),Q.style.setProperty(U,re);const c=s;A.setVolume(c)}let ce=!1,ie=0;function ae(){G.style.height="100px",G.style.backgroundColor="rgba(255, 255, 255, 0.3)",G.style.marginBottom="73px",K.style.display="flex"}function de(e){fetch(e).then((e=>e.text())).then((t=>{const n=(new DOMParser).parseFromString(t,"text/html"),o=n.querySelector("main"),r=n.querySelector("header"),s=document.querySelector("main"),c=document.querySelector("header");s.innerHTML="",c.innerHTML="",s.innerHTML=o.innerHTML,c.innerHTML=r.innerHTML,pageTitle=e.charAt(0),T()})).catch((e=>{console.error(e)}))}function le(e){L.forEach((t=>{e?(t.src="/static/icons/heart.svg",t.classList.remove("inactive"),t.classList.add("active")):(t.src="/static/icons/heart_inactive.svg",t.classList.remove("active"),t.classList.add("inactive")),L.forEach((n=>{n!==t&&(n.classList.toggle("inactive",!e),n.classList.toggle("active",e),n.src=e?"/static/icons/heart.svg":"/static/icons/heart_inactive.svg")}))}))}oe.addEventListener("click",(e=>{let t=re;ce?(oe.src="/static/icons/sound.svg",A.setVolume(ie),Q.style.setProperty(U,t)):(ce=!0,oe.src="/static/icons/mute.svg",ie=A.getVolume(),A.setVolume(0),Q.style.setProperty(U,0))})),G.addEventListener("mouseover",ae),G.addEventListener("mouseleave",(function(){G.style.height="27px",G.style.backgroundColor="transparent",G.style.marginBottom="0",K.style.display="none"})),v.forEach((e=>{c.classList.add("hidden"),e.addEventListener("click",(t=>{document.querySelector("main"),t.preventDefault();const n=e.getAttribute("href");de(n),window.history.pushState({},"",n)}))})),document.querySelector(".logo").addEventListener("click",(e=>{document.querySelector("main"),e.preventDefault(),de("/"),window.history.pushState({},"","/")})),document.querySelector("header .profile-wrapper"),window.addEventListener("popstate",(()=>{de(window.location.href)})),window.onload=()=>{new Promise(((e,t)=>{fetch("/getLoginStatus").then((e=>e.json())).then((t=>{Y=t.loggedIn,e()})).catch((e=>{console.error(e),t(e)}))})).then((()=>{}))},document.querySelector("input[name='keyword']"),L.forEach((e=>{e.addEventListener("click",(()=>{Y&&"none"!==V&&(f=!f,fetch("/like",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({videoId:V})}).then((e=>{})).catch((e=>{console.error("The current music like request encountered an error during processing",e)})),le(f))}))}));const ue=document.querySelectorAll(".like-wrap"),me=document.querySelectorAll(".view-wrap");ue.forEach((e=>{const t=e.querySelector(".tooltip");e.addEventListener("click",(()=>{Y?Y&&!V&&(t.textContent="Please select a song",t.classList.add("show"),setTimeout((function(){t.classList.remove("show")}),2e3)):(t.textContent="Please sign in",t.classList.add("show"),setTimeout((function(){t.classList.remove("show")}),2e3))}))})),me.forEach((e=>{const t=e.querySelector(".tooltip");e.addEventListener("mouseover",(()=>{t.classList.remove("hidden")})),e.addEventListener("mouseout",(()=>{t.classList.add("hidden")}))})),k.forEach((e=>{e.addEventListener("click",(function(){Y?b.classList.toggle("hidden"):alert("Please sign in")}))})),document.addEventListener("click",(function(e){!b.contains(e.target)&!Array.from(k).some((function(t){return t.contains(e.target)}))&&(b.classList.add("hidden"),q.classList.remove("hidden"),E.classList.add("hidden"),w.classList.add("hidden"),E.value=""),b.classList.contains("hidden")||!b.contains(e.target)||S.contains(e.target)||w.contains(e.target)||(q.classList.remove("hidden"),E.classList.add("hidden"),w.classList.add("hidden"),E.value="")}))})();